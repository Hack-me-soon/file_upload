<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GitHub Uploader</title>
    <style>
        /* Your CSS stays here */
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 50px; background: #f4f4f9; }
        #drop-zone { width: 350px; height: 200px; border: 3px dashed #4A90E2; border-radius: 10px; display: flex; align-items: center; justify-content: center; background: white; cursor: pointer; transition: 0.3s; }
        #status { margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>

    <h2>Upload to Repository</h2>
    <div id="drop-zone">Drag & Drop or Click to Select</div>
    <input type="file" id="fileInput" hidden>
    <p>Press <strong>Enter</strong> to save to GitHub</p>
    <div id="status"></div>

    <script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('fileInput');
    const status = document.getElementById('status');
    let selectedFile = null;

    // 1. Click to select (standard)
    dropZone.onclick = () => fileInput.click();
    fileInput.onchange = (e) => handleFile(e.target.files[0]);

    // 2. Handle File Selection Logic
    function handleFile(file) {
        if (!file) return;
        selectedFile = file;
        dropZone.innerText = `Ready to Upload: ${file.name}`;
        dropZone.style.borderColor = "#28a745"; // Green border when loaded
        status.innerText = "File selected. Press 'Enter' to save.";
    }

    // 3. GLOBAL DRAG & DROP (The "Anywhere on Page" fix)
    // Prevent browser from just opening the file
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        window.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
        }, false);
    });

    // Visual feedback when dragging over the window
    window.addEventListener('dragover', () => {
        dropZone.style.background = "#e1edff";
        dropZone.innerText = "Drop it anywhere!";
    });

    window.addEventListener('dragleave', () => {
        dropZone.style.background = "white";
    });

    window.addEventListener('drop', (e) => {
        dropZone.style.background = "white";
        const dt = e.dataTransfer;
        const file = dt.files[0];
        handleFile(file);
    });

    // 4. Keyboard Listener (Enter Key)
    window.addEventListener('keydown', async (e) => {
        if (e.key === 'Enter') {
            if (!selectedFile) {
                status.innerText = "‚ùå Select a file first!";
                status.style.color = "red";
                return;
            }
            uploadToServer();
        }
    });

    async function uploadToServer() {
        const formData = new FormData();
        formData.append('file', selectedFile);

        status.innerText = "üöÄ Uploading to GitHub...";
        status.style.color = "blue";

        try {
            const response = await fetch('/.netlify/functions/upload', { 
                method: 'POST', 
                body: formData 
            });
            
            const result = await response.json();
            if (result.success) {
                status.innerText = "‚úÖ Successfully saved in 'Uploaded_files'!";
                status.style.color = "green";
                // Reset for next upload
                selectedFile = null;
                dropZone.innerText = "Drag & Drop or Click to Select";
                dropZone.style.borderColor = "#4A90E2";
            } else {
                status.innerText = "‚ùå Error: " + result.error;
                status.style.color = "red";
            }
        } catch (err) {
            status.innerText = "‚ùå Connection failed.";
            status.style.color = "red";
        }
    }
</script>
</body>
</html>