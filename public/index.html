<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Private Uploader</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; min-height: 100vh; margin: 0;
            background: #f0f2f5; color: #333;
        }
        h2 { margin-bottom: 10px; color: #1a1a1a; }
        #drop-zone { 
            width: 400px; height: 250px; border: 3px dashed #4A90E2; 
            border-radius: 15px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; 
            background: white; cursor: pointer; transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center; padding: 20px;
        }
        #drop-zone.active { background: #e1edff; border-color: #007AFF; transform: scale(1.02); }
        #status { margin-top: 25px; font-weight: 600; font-size: 1.1rem; min-height: 1.5em; }
        .hint { margin-top: 15px; font-size: 0.9rem; color: #666; }
        strong { color: #007AFF; }
    </style>
</head>
<body>

    <h2>Secure GitHub Storage</h2>
    <div id="drop-zone" id="dropZone">
        <span id="drop-text">Drag & Drop anywhere <br> or Click to Select</span>
    </div>
    <input type="file" id="fileInput" hidden>
    
    <p class="hint">Press <strong>Enter</strong> to save to the "Uploaded_files" folder</p>
    <div id="status"></div>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('fileInput');
        const status = document.getElementById('status');
        const dropText = document.getElementById('drop-text');
        let selectedFile = null;
        let dragCounter = 0;

        // File Selection Logic
        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = (e) => handleFile(e.target.files[0]);

        function handleFile(file) {
            if (!file) return;
            selectedFile = file;
            dropText.innerHTML = `<strong>File Ready:</strong><br>${file.name}`;
            dropZone.style.borderColor = "#28a745";
            status.innerText = "Ready! Press Enter to upload.";
            status.style.color = "#333";
        }

        // Global Drag & Drop Listeners
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(name => {
            window.addEventListener(name, (e) => {
                e.preventDefault();
                e.stopPropagation();
            }, false);
        });

        window.addEventListener('dragenter', () => {
            dragCounter++;
            dropZone.classList.add('active');
            if (!selectedFile) dropText.innerText = "Drop it now!";
        });

        window.addEventListener('dragleave', () => {
            dragCounter--;
            if (dragCounter === 0) dropZone.classList.remove('active');
        });

        window.addEventListener('drop', (e) => {
            dragCounter = 0;
            dropZone.classList.remove('active');
            handleFile(e.dataTransfer.files[0]);
        });

        // Enter Key Listener
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                if (!selectedFile) {
                    status.innerText = "‚ö†Ô∏è Please select a file first.";
                    status.style.color = "#d9534f";
                    return;
                }
                uploadToServer();
            }
        });

        async function uploadToServer() {
            const formData = new FormData();
            formData.append('file', selectedFile);

            status.innerText = "üì§ Uploading to GitHub...";
            status.style.color = "#007AFF";

            try {
                const response = await fetch('/upload', { 
                    method: 'POST', 
                    body: formData 
                });
                
                const result = await response.json();
                if (result.success) {
                    status.innerText = "‚úÖ Successfully saved!";
                    status.style.color = "#28a745";
                    // Reset
                    selectedFile = null;
                    dropText.innerHTML = "Drag & Drop anywhere <br> or Click to Select";
                    dropZone.style.borderColor = "#4A90E2";
                } else {
                    status.innerText = "‚ùå Error: " + result.error;
                    status.style.color = "#d9534f";
                }
            } catch (err) {
                status.innerText = "‚ùå Connection failed.";
                status.style.color = "#d9534f";
            }
        }
    </script>
</body>
</html>